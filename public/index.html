<!DOCTYPE html>
<html lang="nl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Allocat - Smart Portfolio Builder</title>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        .container { max-width: 1400px; margin: 0 auto; }
        header { 
            text-align: center; 
            color: white; 
            margin-bottom: 30px;
            padding-top: 20px;
        }
        .logo-container {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 15px;
            margin-bottom: 15px;
        }
        .logo {
            width: 60px;
            height: 60px;
        }
        h1 { font-size: 2.8em; margin-bottom: 5px; margin: 0; }
        .tagline { font-size: 1.1em; opacity: 0.9; }
        
        .language-toggle {
            text-align: center;
            margin-bottom: 20px;
        }
        .language-toggle button {
            background: rgba(255,255,255,0.2);
            color: white;
            border: 1px solid white;
            padding: 8px 16px;
            margin: 0 5px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 14px;
        }
        .language-toggle button.active {
            background: white;
            color: #667eea;
        }
        
        .main-content {
            display: grid;
            grid-template-columns: 1.3fr 1.2fr 0.8fr;
            gap: 20px;
            margin-bottom: 40px;
        }
        
        @media (max-width: 1024px) {
            .main-content { grid-template-columns: 1fr; }
        }
        
        .card {
            background: white;
            border-radius: 16px;
            padding: 28px;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
            border: 1px solid rgba(255,255,255,0.1);
        }
        
        .card h2 { 
            color: #333; 
            margin-bottom: 20px; 
            font-size: 1.3em;
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        label {
            display: block;
            margin-top: 15px;
            color: #555;
            font-weight: 600;
            font-size: 14px;
        }
        
        input[type="text"],
        input[type="number"],
        select {
            width: 100%;
            padding: 12px;
            margin-top: 5px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
            transition: all 0.2s;
        }
        
        input:focus, select:focus {
            border-color: #667eea;
            box-shadow: 0 0 10px rgba(102, 126, 234, 0.1);
            outline: none;
        }
        
        .broker-filter {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin: 15px 0;
        }
        
        .broker-checkbox {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        
        .broker-checkbox input {
            width: auto;
            margin: 0;
            cursor: pointer;
        }
        
        .broker-checkbox label {
            margin: 0;
            font-weight: 500;
            cursor: pointer;
        }
        
        .search-box {
            position: relative;
            margin-bottom: 15px;
        }
        
        .search-results {
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background: white;
            border: 2px solid #ddd;
            border-top: none;
            border-radius: 0 0 8px 8px;
            max-height: 350px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            box-shadow: 0 10px 25px rgba(0,0,0,0.1);
        }
        
        .search-results.active { display: block; }
        
        .search-result-item {
            padding: 14px;
            border-bottom: 1px solid #eee;
            cursor: pointer;
            transition: all 0.2s;
        }
        
        .search-result-item:hover { 
            background: #f5f5f5;
            padding-left: 18px;
        }
        
        .search-result-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .search-result-meta {
            font-size: 12px;
            color: #999;
            margin-top: 4px;
        }
        
        .search-result-broker {
            display: inline-block;
            background: #667eea;
            color: white;
            padding: 2px 8px;
            border-radius: 12px;
            font-size: 11px;
            margin-top: 4px;
        }
        
        .selected-product {
            background: linear-gradient(135deg, #f0f0f0 0%, #f9f9f9 100%);
            border: 2px solid #667eea;
            border-radius: 10px;
            padding: 14px;
            margin-bottom: 12px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: all 0.2s;
        }
        
        .selected-product:hover {
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.2);
        }
        
        .selected-product-info {
            flex: 1;
        }
        
        .selected-product-name {
            font-weight: 600;
            color: #333;
            font-size: 14px;
        }
        
        .remove-btn {
            background: #ff6b6b;
            color: white;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            font-size: 12px;
            transition: all 0.2s;
        }
        
        .remove-btn:hover { 
            background: #ff5252;
            transform: scale(1.05);
        }
        
        button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 14px 28px;
            border: none;
            border-radius: 8px;
            font-size: 16px;
            font-weight: 600;
            cursor: pointer;
            margin-top: 20px;
            width: 100%;
            transition: all 0.3s;
            box-shadow: 0 5px 15px rgba(102, 126, 234, 0.3);
        }
        
        button:hover { 
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(102, 126, 234, 0.4);
        }
        
        .preset-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .preset-buttons button {
            margin: 0;
            padding: 10px;
            font-size: 14px;
        }
        
        .radio-group {
            display: grid;
            grid-template-columns: 1fr;
            gap: 10px;
            margin-top: 10px;
        }
        
        .radio-option {
            position: relative;
        }
        
        .radio-option input {
            display: none;
        }
        
        .radio-option label {
            display: block;
            padding: 12px;
            background: #f5f5f5;
            border: 2px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-weight: 500;
            margin: 0;
            transition: all 0.2s;
        }
        
        .radio-option:hover label {
            background: #efefef;
            border-color: #667eea;
        }
        
        .radio-option input:checked + label {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-color: #667eea;
        }
        
        .risk-explanation {
            background: #f0f7ff;
            border-left: 4px solid #667eea;
            padding: 12px;
            margin-top: 8px;
            border-radius: 6px;
            font-size: 13px;
            color: #333;
            display: none;
            line-height: 1.5;
        }
        
        .radio-option input:checked ~ .risk-explanation {
            display: block;
        }
        
        .results {
            background: white;
            border-radius: 16px;
            padding: 28px;
            margin-top: 20px;
            display: none;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .results.show { display: block; }
        
        .result-item {
            background: linear-gradient(135deg, #f9f9f9 0%, #f5f5f5 100%);
            padding: 16px;
            border-radius: 8px;
            margin-bottom: 12px;
            border-left: 4px solid #667eea;
            transition: all 0.2s;
        }
        
        .result-item:hover {
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }
        
        .result-amount { 
            font-size: 1.4em; 
            font-weight: 700; 
            color: #667eea; 
        }
        
        .chart-container {
            position: relative;
            height: 350px;
            margin-top: 20px;
            display: none;
        }
        
        .chart-container.active { display: block; }
        
        .export-buttons {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: 20px;
        }
        
        .export-buttons button {
            margin: 0;
            padding: 10px;
            font-size: 14px;
        }
        
        .education-panel {
            background: white;
            border-radius: 16px;
            padding: 24px;
            font-size: 13px;
            line-height: 1.7;
            box-shadow: 0 15px 35px rgba(0,0,0,0.2);
        }
        
        .education-panel h3 {
            color: #667eea;
            margin-bottom: 16px;
            font-size: 15px;
        }
        
        .education-panel p {
            margin-bottom: 12px;
            color: #555;
        }
        
        .strategy-box {
            background: linear-gradient(135deg, #f0f7ff 0%, #f5f5f5 100%);
            border-radius: 8px;
            padding: 16px;
            margin-top: 20px;
            border-left: 4px solid #667eea;
        }
        
        .strategy-box h4 {
            color: #667eea;
            margin-bottom: 8px;
            font-size: 14px;
        }
        
        .strategy-box p {
            color: #555;
            font-size: 13px;
            line-height: 1.6;
        }
        
        footer {
            text-align: center;
            color: white;
            margin-top: 50px;
            opacity: 0.9;
        }
        
        .product-info {
            background: #f9f9f9;
            padding: 10px;
            border-radius: 6px;
            margin-top: 8px;
            font-size: 12px;
            color: #666;
        }
        
        .product-info div {
            margin: 3px 0;
        }
        
        .no-results {
            text-align: center;
            color: #999;
            padding: 40px 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="logo-container">
                <svg class="logo" viewBox="0 0 100 100" xmlns="http://www.w3.org/2000/svg">
                    <!-- Kat hoofd -->
                    <circle cx="50" cy="45" r="30" fill="#FFB84D"/>
                    <!-- Oren -->
                    <polygon points="35,20 30,5 40,15" fill="#FFB84D"/>
                    <polygon points="65,20 70,5 60,15" fill="#FFB84D"/>
                    <!-- Ogen -->
                    <circle cx="42" cy="40" r="4" fill="#333"/>
                    <circle cx="58" cy="40" r="4" fill="#333"/>
                    <!-- Mond -->
                    <path d="M 50 45 Q 45 50 42 48" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round"/>
                    <path d="M 50 45 Q 55 50 58 48" fill="none" stroke="#333" stroke-width="1.5" stroke-linecap="round"/>
                    <!-- Munten rond kat -->
                    <circle cx="75" cy="35" r="8" fill="#FFD700" stroke="#FFA500" stroke-width="1"/>
                    <text x="75" y="38" font-size="8" font-weight="bold" text-anchor="middle" fill="#333">‚Ç¨</text>
                    <circle cx="70" cy="60" r="7" fill="#FFA500" stroke="#FF8C00" stroke-width="1"/>
                    <text x="70" y="63" font-size="7" font-weight="bold" text-anchor="middle" fill="white">$</text>
                    <circle cx="30" cy="65" r="6" fill="#C0C0C0" stroke="#A9A9A9" stroke-width="1"/>
                    <text x="30" y="67" font-size="6" font-weight="bold" text-anchor="middle" fill="#333">¬•</text>
                </svg>
                <h1>Allocat</h1>
            </div>
            <p class="tagline" id="tagline">Smart portfolio builder voor alle brokers</p>
        </header>
        
        <div class="language-toggle">
            <button class="active" onclick="setLanguage('nl')">üá≥üá± Nederlands</button>
            <button onclick="setLanguage('en')">üá¨üáß English</button>
        </div>
        
        <div class="main-content">
            <!-- LEFT: INPUT -->
            <div class="card">
                <h2 id="step1-title">üì± Stap 1: Kies Brokers & Producten</h2>
                
                <label id="broker-label">Selecteer brokers:</label>
                <div class="broker-filter">
                    <div class="broker-checkbox">
                        <input type="checkbox" id="degiro" value="DEGIRO" checked onchange="filterUpdate()">
                        <label for="degiro">DEGIRO</label>
                    </div>
                    <div class="broker-checkbox">
                        <input type="checkbox" id="bux" value="Bux" checked onchange="filterUpdate()">
                        <label for="bux">Bux</label>
                    </div>
                    <div class="broker-checkbox">
                        <input type="checkbox" id="traderepublic" value="Trade Republic" checked onchange="filterUpdate()">
                        <label for="traderepublic">Trade Republic</label>
                    </div>
                    <div class="broker-checkbox">
                        <input type="checkbox" id="binance" value="Binance" checked onchange="filterUpdate()">
                        <label for="binance">Binance</label>
                    </div>
                </div>
                
                <div class="search-box">
                    <label for="productSearch" id="search-label">Zoek producten:</label>
                    <input type="text" id="productSearch" placeholder="SNAW, Bitcoin, Gold...">
                    <div class="search-results" id="searchResults"></div>
                </div>
                
                <div id="selectedProducts"></div>
                
                <h2 style="margin-top: 25px;" id="step2-title">üí∞ Stap 2: Budget</h2>
                
                <div class="preset-buttons">
                    <button onclick="setBudget(500)">‚Ç¨500</button>
                    <button onclick="setBudget(1000)">‚Ç¨1000</button>
                    <button onclick="setBudget(5000)">‚Ç¨5000</button>
                </div>
                
                <label for="customBudget" id="custom-label">Custom bedrag:</label>
                <input type="number" id="customBudget" placeholder="‚Ç¨2500" value="1000">
                
                <h2 style="margin-top: 25px;" id="step3-title">üìä Stap 3: Risicoprofiel</h2>
                
                <div class="radio-group">
                    <div class="radio-option">
                        <input type="radio" name="risk" id="risk1" value="conservative">
                        <label for="risk1">üõ°Ô∏è Conservatief</label>
                        <div class="risk-explanation">
                            <strong>30% Growth / 70% Stable</strong><br>
                            Veiligheid prioriteit. Voor voorzichtige beleggers. Rendement: 4-5%/jaar
                        </div>
                    </div>
                    
                    <div class="radio-option">
                        <input type="radio" name="risk" id="risk2" value="balanced" checked>
                        <label for="risk2">‚≠ê Gebalanceerd</label>
                        <div class="risk-explanation">
                            <strong>50% Growth / 50% Stable</strong><br>
                            Perfect voor meeste beleggers. 20+ jaar horizon. Rendement: 6-7%/jaar
                        </div>
                    </div>
                    
                    <div class="radio-option">
                        <input type="radio" name="risk" id="risk3" value="growth">
                        <label for="risk3">üìà Groei</label>
                        <div class="risk-explanation">
                            <strong>70% Growth / 30% Stable</strong><br>
                            Meer rendement potentieel. Voor jonge beleggers. Rendement: 7-8%/jaar
                        </div>
                    </div>
                    
                    <div class="radio-option">
                        <input type="radio" name="risk" id="risk4" value="aggressive">
                        <label for="risk4">üöÄ Agressief</label>
                        <div class="risk-explanation">
                            <strong>80% Growth / 20% Stable</strong><br>
                            Maximale groei. Accept 30%+ volatiliteit. Rendement: 8-10%/jaar
                        </div>
                    </div>
                </div>
                
                <button onclick="calculate()" id="calc-btn">üéØ Bereken Allocatie</button>
            </div>
            
            <!-- MIDDLE: RESULTS -->
            <div>
                <div class="card">
                    <h2 id="results-title">üìà Je Portfolio</h2>
                    <div id="chartContainer" class="chart-container">
                        <canvas id="allocationChart"></canvas>
                    </div>
                    <div id="noResults" class="no-results">
                        üëà Selecteer producten
                    </div>
                    <div id="results"></div>
                </div>
            </div>
            
            <!-- RIGHT: EDUCATION -->
            <div class="education-panel">
                <h3>üí° Allocat Info</h3>
                
                <div id="educationContent">
                    <p><strong>Wat is Allocat?</strong></p>
                    <p>De slimste portfolio builder. Kies producten van alle grote brokers en we tonen je de perfecte allocatie.</p>
                    
                    <p style="margin-top: 15px;"><strong>Hoe werkt het?</strong></p>
                    <p>1. Kies brokers<br>2. Zoek producten<br>3. Stel budget in<br>4. Kies risico<br>5. Wij berekenen!</p>
                    
                    <p style="margin-top: 15px;"><strong>Waarom diversifi√´ren?</strong></p>
                    <p>Verspreiding van risico. Niet alles in √©√©n product. Beter sleepgewicht op lange termijn.</p>
                    
                    <p style="margin-top: 15px;"><strong>Brokers:</strong></p>
                    <p>‚úì DEGIRO (500+ producten)<br>‚úì Bux (200+ assets)<br>‚úì Trade Republic (1500+ items)<br>‚úì Binance (1000+ crypto)</p>
                </div>
            </div>
        </div>
        
        <footer>
            <p>üê± Allocat - Smart Portfolio Builder 2025</p>
            <p style="margin-top: 10px; font-size: 0.9em;">
                <a href="mailto:your-email@gmail.com" style="color: white; text-decoration: underline;">Feedback</a> | 
                <a href="https://github.com" style="color: white; text-decoration: underline;">GitHub</a>
            </p>
        </footer>
    </div>
    
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script>
        let chart = null;
        let selectedProducts = [];
        let currentLanguage = 'nl';
        let activeBrokers = ['DEGIRO', 'Bux', 'Trade Republic', 'Binance'];
        
        const translations = {
            nl: {
                tagline: 'Smart portfolio builder voor alle brokers',
                step1: 'üì± Stap 1: Kies Brokers & Producten',
                step2: 'üí∞ Stap 2: Budget',
                step3: 'üìä Stap 3: Risicoprofiel',
                search: 'Zoek producten',
                brokerLabel: 'Selecteer brokers:',
                custom: 'Custom bedrag:',
                calculate: 'üéØ Bereken Allocatie',
                portfolio: 'üìà Je Portfolio',
                allocation: 'üìä Je Allocatie',
                exportJSON: 'Export JSON',
                exportCSV: 'Export CSV',
                noProducts: 'Selecteer tenminste 1 product',
                selectProducts: 'üëà Selecteer producten',
                calculate: 'üéØ Bereken Allocatie'
            },
            en: {
                tagline: 'Smart portfolio builder for all brokers',
                step1: 'üì± Step 1: Choose Brokers & Products',
                step2: 'üí∞ Step 2: Budget',
                step3: 'üìä Step 3: Risk Profile',
                search: 'Search products',
                brokerLabel: 'Select brokers:',
                custom: 'Custom amount:',
                calculate: 'üéØ Calculate Allocation',
                portfolio: 'üìà Your Portfolio',
                allocation: 'üìä Your Allocation',
                exportJSON: 'Export JSON',
                exportCSV: 'Export CSV',
                noProducts: 'Select at least 1 product',
                selectProducts: 'üëà Select products',
                calculate: 'üéØ Calculate Allocation'
            }
        };
        
        const allProducts = [
            // DEGIRO ETFs
            { name: 'iShares MSCI World', ticker: 'SNAW', isin: 'IE00BFNM3J75', broker: 'DEGIRO', type: 'World ETF', ter: '0.20%', risk: 'Medium' },
            { name: 'iShares MSCI EM IMI', ticker: 'AYEM', isin: 'IE00BFNM3P36', broker: 'DEGIRO', type: 'EM ETF', ter: '0.18%', risk: 'High' },
            { name: 'iShares Core MSCI World', ticker: 'IWDA', isin: 'IE00B4L5Y983', broker: 'DEGIRO', type: 'World ETF', ter: '0.20%', risk: 'Medium' },
            { name: 'Vanguard FTSE All-World', ticker: 'VWRL', isin: 'IE00B8KQN627', broker: 'DEGIRO', type: 'World ETF', ter: '0.22%', risk: 'Medium' },
            { name: 'iShares MSCI USA', ticker: 'EUSA', isin: 'IE00BJ0KDQ92', broker: 'DEGIRO', type: 'US ETF', ter: '0.07%', risk: 'Medium' },
            { name: 'iShares Core Euro Govt Bond', ticker: 'IEGA', isin: 'IE00B4WXJJ64', broker: 'DEGIRO', type: 'Bond ETF', ter: '0.07%', risk: 'Low' },
            { name: 'Invesco Physical Gold', ticker: '8PSG', isin: 'IE00B579F325', broker: 'DEGIRO', type: 'Commodity', ter: '0.12%', risk: 'Medium' },
            { name: 'iShares MSCI Japan', ticker: 'CJPN', isin: 'IE00BKM4GZ67', broker: 'DEGIRO', type: 'Regional', ter: '0.48%', risk: 'Medium' },
            { name: 'iShares MSCI Europe', ticker: 'IEUR', isin: 'IE00BD1F4K48', broker: 'DEGIRO', type: 'Regional', ter: '0.20%', risk: 'Medium' },
            { name: 'Xtrackers MSCI World', ticker: 'XWDA', isin: 'IE00BTJRMP35', broker: 'DEGIRO', type: 'World ETF', ter: '0.12%', risk: 'Medium' },
            // Bux Assets
            { name: 'Apple Inc', ticker: 'AAPL', isin: 'US0378331005', broker: 'Bux', type: 'Stock', ter: '0.00%', risk: 'High' },
            { name: 'Tesla Inc', ticker: 'TSLA', isin: 'US88160R1014', broker: 'Bux', type: 'Stock', ter: '0.00%', risk: 'Very High' },
            { name: 'Microsoft Corp', ticker: 'MSFT', isin: 'US5949181045', broker: 'Bux', type: 'Stock', ter: '0.00%', risk: 'High' },
            { name: 'Amazon.com Inc', ticker: 'AMZN', isin: 'US0231351067', broker: 'Bux', type: 'Stock', ter: '0.00%', risk: 'High' },
            { name: 'Nvidia Corp', ticker: 'NVDA', isin: 'US67066991', broker: 'Bux', type: 'Stock', ter: '0.00%', risk: 'Very High' },
            // Trade Republic Popular
            { name: 'SPY - S&P 500 ETF', ticker: 'SPY', isin: 'US78462F1030', broker: 'Trade Republic', type: 'US ETF', ter: '0.03%', risk: 'Medium' },
            { name: 'VOO - Vanguard S&P 500', ticker: 'VOO', isin: 'US9229087690', broker: 'Trade Republic', type: 'US ETF', ter: '0.03%', risk: 'Medium' },
            { name: 'QQQ - Nasdaq 100', ticker: 'QQQ', isin: 'US6311011026', broker: 'Trade Republic', type: 'Tech ETF', ter: '0.20%', risk: 'High' },
            { name: 'IVV - Core S&P 500', ticker: 'IVV', isin: 'US4642881175', broker: 'Trade Republic', type: 'US ETF', ter: '0.03%', risk: 'Medium' },
            { name: 'EEM - Emerging Markets', ticker: 'EEM', isin: 'US4642881175', broker: 'Trade Republic', type: 'EM ETF', ter: '0.68%', risk: 'High' },
            // Binance Crypto
            { name: 'Bitcoin', ticker: 'BTC', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Ethereum', ticker: 'ETH', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Solana', ticker: 'SOL', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'XRP', ticker: 'XRP', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Cardano', ticker: 'ADA', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Polkadot', ticker: 'DOT', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Litecoin', ticker: 'LTC', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            { name: 'Dogecoin', ticker: 'DOGE', isin: 'N/A', broker: 'Binance', type: 'Crypto', ter: 'Variable', risk: 'Very High' },
            // More DEGIRO
            { name: 'iShares Euro High Yield Bond', ticker: 'IEHY', isin: 'IE00B0M63984', broker: 'DEGIRO', type: 'Bond ETF', ter: '0.35%', risk: 'Medium' },
            { name: 'Vanguard FTSE European', ticker: 'VERX', isin: 'IE00B945VV12', broker: 'DEGIRO', type: 'Regional', ter: '0.10%', risk: 'Medium' },
            { name: 'Vanguard US Equity Index', ticker: 'VUSA', isin: 'IE00B3RBWM25', broker: 'DEGIRO', type: 'US ETF', ter: '0.08%', risk: 'Medium' },
            { name: 'iShares Physical Silver', ticker: 'SLV', isin: 'US4642881175', broker: 'DEGIRO', type: 'Commodity', ter: '0.30%', risk: 'Medium' },
            { name: 'iShares Global Clean Energy', ticker: 'ICLN', isin: 'IE00B1XNRQ01', broker: 'DEGIRO', type: 'Thematic', ter: '0.65%', risk: 'High' }
        ];
        
        function setLanguage(lang) {
            currentLanguage = lang;
            document.querySelectorAll('.language-toggle button').forEach(el => el.classList.remove('active'));
            event.target.classList.add('active');
            updateLanguage();
        }
        
        function updateLanguage() {
            const t = translations[currentLanguage];
            document.getElementById('tagline').textContent = t.tagline;
            document.getElementById('step1-title').textContent = t.step1;
            document.getElementById('step2-title').textContent = t.step2;
            document.getElementById('step3-title').textContent = t.step3;
        }
        
        function filterUpdate() {
            activeBrokers = [];
            document.querySelectorAll('.broker-checkbox input:checked').forEach(cb => {
                activeBrokers.push(cb.value);
            });
        }
        
        function fuzzySearch(query) {
            if (!query) return [];
            const q = query.toLowerCase();
            return allProducts.filter(p => {
                if (!activeBrokers.includes(p.broker)) return false;
                const name = p.name.toLowerCase();
                const ticker = p.ticker.toLowerCase();
                return name.includes(q) || ticker.includes(q);
            }).slice(0, 12);
        }
        
        document.getElementById('productSearch').addEventListener('input', (e) => {
            const query = e.target.value;
            const results = fuzzySearch(query);
            const resultsDiv = document.getElementById('searchResults');
            
            if (query.length > 0 && results.length > 0) {
                resultsDiv.classList.add('active');
                resultsDiv.innerHTML = results.map(p => `
                    <div class="search-result-item" onclick="selectProduct('${p.ticker}')">
                        <div class="search-result-name">${p.ticker} - ${p.name}</div>
                        <div class="search-result-meta">${p.type} | TER: ${p.ter} | ${p.risk}</div>
                        <div class="search-result-broker">${p.broker}</div>
                    </div>
                `).join('');
            } else {
                resultsDiv.classList.remove('active');
            }
        });
        
        function selectProduct(ticker) {
            const product = allProducts.find(p => p.ticker === ticker);
            if (product && !selectedProducts.find(p => p.ticker === ticker)) {
                selectedProducts.push(product);
                renderSelected();
                document.getElementById('productSearch').value = '';
                document.getElementById('searchResults').classList.remove('active');
            }
        }
        
        function removeProduct(ticker) {
            selectedProducts = selectedProducts.filter(p => p.ticker !== ticker);
            renderSelected();
        }
        
        function renderSelected() {
            const container = document.getElementById('selectedProducts');
            container.innerHTML = selectedProducts.map(p => `
                <div class="selected-product">
                    <div class="selected-product-info">
                        <div class="selected-product-name">${p.ticker} - ${p.name}</div>
                        <div class="product-info">
                            <div>${p.broker} | ${p.type} | TER: ${p.ter}</div>
                        </div>
                    </div>
                    <button class="remove-btn" onclick="removeProduct('${p.ticker}')">‚úï</button>
                </div>
            `).join('');
        }
        
        function setBudget(amount) {
            document.getElementById('customBudget').value = amount;
        }
        
        function calculate() {
            if (selectedProducts.length === 0) {
                alert(translations[currentLanguage].noProducts);
                return;
            }
            
            const budget = parseFloat(document.getElementById('customBudget').value) || 1000;
            const risk = document.querySelector('input[name="risk"]:checked').value;
            
            let allocations = [];
            if (selectedProducts.length === 1) {
                allocations = [1];
            } else {
                const baseAlloc = 1 / selectedProducts.length;
                allocations = selectedProducts.map(() => baseAlloc);
            }
            
            let resultsHTML = `<h3>${translations[currentLanguage].allocation}</h3>`;
            selectedProducts.forEach((p, i) => {
                const amount = budget * allocations[i];
                resultsHTML += `
                    <div class="result-item">
                        <strong>${p.ticker} - ${p.name}</strong><br>
                        <span class="result-amount">‚Ç¨${amount.toFixed(2)}</span> (${(allocations[i]*100).toFixed(0)}%)
                        <div class="product-info">
                            <div>${p.broker} | ${p.type} | TER: ${p.ter}</div>
                        </div>
                    </div>
                `;
            });
            
            resultsHTML += `
                <div style="margin-top: 20px; padding-top: 20px; border-top: 2px solid #ddd;">
                    <strong>Total Budget: ‚Ç¨${budget.toFixed(2)}</strong>
                </div>
                <div class="export-buttons">
                    <button onclick="exportJSON()">üì• JSON</button>
                    <button onclick="exportCSV()">üì• CSV</button>
                </div>
            `;
            
            document.getElementById('results').innerHTML = resultsHTML;
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('chartContainer').classList.add('active');
            
            const ctx = document.getElementById('allocationChart').getContext('2d');
            if (chart) chart.destroy();
            
            chart = new Chart(ctx, {
                type: 'pie',
                data: {
                    labels: selectedProducts.map(p => p.ticker),
                    datasets: [{
                        data: allocations.map(a => (a*100).toFixed(1)),
                        backgroundColor: [
                            '#667eea', '#764ba2', '#f093fb', '#ff6b9d', '#ffa502',
                            '#26de81', '#20c997', '#0984e3', '#6c5ce7', '#a29bfe',
                            '#fd79a8', '#fdcb6e', '#6c5ce7', '#a29bfe'
                        ]
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: { position: 'bottom' }
                    }
                }
            });
        }
        
        function exportJSON() {
            const data = {
                app: 'Allocat',
                products: selectedProducts,
                budget: document.getElementById('customBudget').value,
                riskProfile: document.querySelector('input[name="risk"]:checked').value,
                timestamp: new Date().toISOString()
            };
            const json = JSON.stringify(data, null, 2);
            const blob = new Blob([json], { type: 'application/json' });
            downloadFile(blob, 'allocat-portfolio.json');
        }
        
        function exportCSV() {
            let csv = 'Ticker,Product,Broker,Type,TER,Risk\n';
            selectedProducts.forEach(p => {
                csv += `"${p.ticker}","${p.name}","${p.broker}","${p.type}","${p.ter}","${p.risk}"\n`;
            });
            const blob = new Blob([csv], { type: 'text/csv' });
            downloadFile(blob, 'allocat-portfolio.csv');
        }
        
        function downloadFile(blob, filename) {
            const url = window.URL.createObjectURL(blob);
            const link = document.createElement('a');
            link.href = url;
            link.download = filename;
            document.body.appendChild(link);
            link.click();
            document.body.removeChild(link);
            window.URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
